<!doctype html><html><head><title>Day 7: Bags</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/assets/css/bootstrap.min.css><link rel=stylesheet href=/assets/css/layouts/main.css><link rel=stylesheet href=/assets/css/style.css><link rel=stylesheet href=/assets/css/navigators/navbar.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/assets/images/favicon.png><link rel=stylesheet href=/assets/css/style.css><meta name=description content="Day 7 of AoC 2020"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/assets/css/layouts/single.css><link rel=stylesheet href=/assets/css/navigators/sidebar.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/assets/images/main-logo.png>Kristof Achten | Portfolio & Blog</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/assets/images/main-logo.png class=d-none id=main-logo>
<img src=/assets/images/inverted-logo.png class=d-none id=inverted-logo></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><input type=text placeholder=Search data-search id=search-box><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-minus-circle"></i><a class=active href>Advent of Code 2020</a><ul class=active><li><a href=/posts/advent-of-code-2020/day1/>Day 1</a></li><li><a href=/posts/advent-of-code-2020/day2/>Day 2</a></li><li><a href=/posts/advent-of-code-2020/day3/>Day 3</a></li><li><a href=/posts/advent-of-code-2020/day4/>Day 4</a></li><li><a href=/posts/advent-of-code-2020/day5/>Day 5</a></li><li><a href=/posts/advent-of-code-2020/day6/>Day 6</a></li><li><a class=active href=/posts/advent-of-code-2020/day7/>Day 7</a></li><li><a href=/posts/advent-of-code-2020/day8/>Day 8</a></li><li><a href=/posts/advent-of-code-2020/day9/>Day 9</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://kristofachten.github.io/posts/Advent%20of%20Code%202020/aoc.jpeg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/me.png><h5 class=author-name>Kristof Achten</h5><p>December 7, 2020</p></div><div class=title><h1>Day 7: Bags</h1></div><div class=post-content id=post-content><h2 id=intro>Intro</h2><p>Interesting challenge today: recursion! We&rsquo;ve landed at the airport and get to take on the exciting challenge of retrieving our bags from the carousel of doom. Fortunately, bags are color coded. Unfortunately, the bags can be inside each other with respect to a set of predefined regulations. Our puzzle input is this set of regulations, which looks a bit like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>light red bags contain <span style=color:#ae81ff>1</span> bright white bag, <span style=color:#ae81ff>2</span> muted yellow bags.
dark orange bags contain <span style=color:#ae81ff>3</span> bright white bags, <span style=color:#ae81ff>4</span> muted yellow bags.
bright white bags contain <span style=color:#ae81ff>1</span> shiny gold bag.
muted yellow bags contain <span style=color:#ae81ff>2</span> shiny gold bags, <span style=color:#ae81ff>9</span> faded blue bags.
shiny gold bags contain <span style=color:#ae81ff>1</span> dark olive bag, <span style=color:#ae81ff>2</span> vibrant plum bags.
dark olive bags contain <span style=color:#ae81ff>3</span> faded blue bags, <span style=color:#ae81ff>4</span> dotted black bags.
vibrant plum bags contain <span style=color:#ae81ff>5</span> faded blue bags, <span style=color:#ae81ff>6</span> dotted black bags.
faded blue bags contain no other bags.
dotted black bags contain no other bags.
</code></pre></div><p>These rules specify 9 bag types (= colors) and their contents.</p><h2 id=solution>Solution</h2><p>As you might&rsquo;ve expected, parsing our input is a challenge on its own. There are a few ways to tackle this, but since they all follow roughly the same pattern, I simple went with extensively using <code>String.split()</code>.</p><p>First however, we&rsquo;ll need to think about a way to store these bags. The chances are high that we&rsquo;ll effectively need to search what the contents of a bag are given its color, so it makes sense to use a Map-type to store them in as this allows for easy querying. Given a color, the map should return a list of tuples containing the contents of that bag.</p><p>The map could look something like this: <code>Map&lt;color: String, content: List&lt;Pair&lt;color: String, count: Int>>></code>. Just for clarity, I decided to put <code>Pair&lt;color: String, count: Int></code> in its own data definition:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BagContent</span>(<span style=color:#66d9ef>val</span> color: String, <span style=color:#66d9ef>val</span> count: Int)

<span style=color:#66d9ef>val</span> bagDefs = mutableMapOf&lt;String, List&lt;BagContent&gt;&gt;()
</code></pre></div><p>For the actual processing of the input, we start by splitting it up into its different lines:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>val</span> input = rawInput.split(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</code></pre></div><p>Given each line, we can then use its somewhat steady pattern to split the definition up into the different parts.</p><p>First, we&rsquo;ll need to separate its color from its content, which can easily be done through calling <code>line.split(" bags contain ")</code> (note the spaces at the start and at the end). Then, continue by splitting up the contents&mldr; but only if it has any to start with! Check that <code>content.equals("no other bags.")</code> returns false before you continue. Remove the dots and comma&rsquo;s from the remaining string and replace the word &lsquo;bags&rsquo; by &lsquo;bag&rsquo; (since they will be used interchangeably depending on the count for that type of bag). This now allows us to split on the word <code>bag</code> using <code>.split(" bag")</code> (again, mind the space!), but this has the tendency to generate an empty string at the end of the resulting list since <code>bag</code> is the last word in the original string. This is just how <code>.split()</code> works (<a href=https://stackoverflow.com/questions/4964484/why-does-split-on-an-empty-string-return-a-non-empty-array>and this is why</a>), so just filter them out using <code>.filter { it.isNotBlank() }</code>.</p><p>At this point, we have a list of content definitions that are separated by spaces. Simply split each of them up using <code>.split(" ")</code>, and add them to a <code>List&lt;BagContent></code>. If your bag did not have any contents to begin with, just leave this list empty.</p><p>Finally, just put the color and this generated list of <code>BagContent</code> data in the <code>bagDefs</code>-map.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>init</span> {
	<span style=color:#66d9ef>for</span> (line <span style=color:#66d9ef>in</span> input) {
		<span style=color:#66d9ef>val</span> bagAndContent = line.split(<span style=color:#e6db74>&#34; bags contain &#34;</span>)

		<span style=color:#66d9ef>var</span> contentList = mutableListOf&lt;BagContent&gt;()
		<span style=color:#66d9ef>if</span> (!bagAndContent[<span style=color:#ae81ff>1</span>].equals(<span style=color:#e6db74>&#34;no other bags.&#34;</span>)) {
			<span style=color:#66d9ef>val</span> contentDefs = bagAndContent[<span style=color:#ae81ff>1</span>]
					.replace(<span style=color:#e6db74>&#34;.&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
					.replace(<span style=color:#e6db74>&#34;, &#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
					.replace(<span style=color:#e6db74>&#34;bags&#34;</span>, <span style=color:#e6db74>&#34;bag&#34;</span>)
					.split(<span style=color:#e6db74>&#34; bag&#34;</span>)
					.filter { <span style=color:#66d9ef>it</span>.isNotBlank() }

			contentDefs.forEach() { contentDef <span style=color:#f92672>-&gt;</span>
				<span style=color:#66d9ef>val</span> parts = contentDef.split(<span style=color:#e6db74>&#34; &#34;</span>)
				contentList.add(BagContent(parts[<span style=color:#ae81ff>1</span>] + <span style=color:#e6db74>&#34; &#34;</span> + parts[<span style=color:#ae81ff>2</span>], parts[<span style=color:#ae81ff>0</span>].toInt()))
			}
		}

		bagDefs.put(bagAndContent[<span style=color:#ae81ff>0</span>], contentList)
	}
}
</code></pre></div><h3 id=part-1>Part 1</h3><p>For part one, the question at hand is straightforward: How many bag colors can eventually contain at least one shiny gold bag?</p><p>Essentially, this requires us to go through all the definitions we just inserted into <code>bagDefs</code>, and filter out those where there is no path towards a <code>shiny gold</code> bag. As soon as we have this filtered list, we just return the amount of elements in it.</p><p>To determine if a bag can (eventually) contain the shiny gold bag, we&rsquo;ll need to define a recursive function. This function will need to stop (and return true) if it gets to a bag where the color is <code>shiny gold</code>, or else check if any of its content-bags could contain this color. This gives use the following definition:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>containsBag</span>(color: String, curColor: String, list: List&lt;BagContent&gt;): Boolean {
	<span style=color:#66d9ef>if</span> (color.equals(curColor)) {
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
	}
	<span style=color:#66d9ef>return</span> list.any() { containsBag(color, <span style=color:#66d9ef>it</span>.color, bagDefs.<span style=color:#66d9ef>get</span>(<span style=color:#66d9ef>it</span>.color)<span style=color:#f92672>!!</span>) }
}
</code></pre></div><p>Given this function, solving part one becomes trivial. One thing we&rsquo;ll need to account for is the fact that the shiny gold bag itself will return true as well (for obvious reasons), but for this challenge we&rsquo;re not supposed to count it. We can easily extend our filter to not include this bag definition.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>val</span> shinyGold = <span style=color:#e6db74>&#34;shiny gold&#34;</span>

<span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>part1</span>() = bagDefs.filter { !<span style=color:#66d9ef>it</span>.key.equals(shinyGold) <span style=color:#f92672>&amp;&amp;</span> containsBag(shinyGold, <span style=color:#66d9ef>it</span>.key, <span style=color:#66d9ef>it</span>.value) }.count().toString()
</code></pre></div><h3 id=part-2>Part 2</h3><p>Part two is similar in nature, but the question is different: How many individual bags are required inside your single shiny gold bag?</p><p>So essentially: what is the total number of bags (or if you prefer: nodes) in the tree that is defined by the shiny gold bag? Again, we can define a recursive function for this. However, since we&rsquo;re now actually counting something in this function, the definition becomes slightly more difficult: given a color, the function will look up the contents for it in our <code>bagDefs</code>-map. If this list of contents is empty, it will simply stop and return <code>0</code>. If it is not empty: it will return the sum of the results for the recursive calls on each of the bags in its content list.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>return</span> bagDefs.<span style=color:#66d9ef>get</span>(color)<span style=color:#f92672>!!</span>.map { <span style=color:#66d9ef>it</span>.count * (<span style=color:#ae81ff>1</span> + countBags(<span style=color:#66d9ef>it</span>.color)) }.sum()
</code></pre></div><p>This should be relatively straightforward: you determine the amount of bags in a given color, and multiply it by the amount of bags that were there in the first place. An easy mistake to make is forget about the current bag itself, and thus omitting the <code>1 +</code> (or alternatively: <code>it.count + it.count * countBags(it.color)</code>) from the statement above.</p><p>This gives us our final result:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>part2</span>() = countBags(shinyGold).toString()

<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>countBags</span>(color: String): Int {
	<span style=color:#66d9ef>if</span> (bagDefs.<span style=color:#66d9ef>get</span>(color)<span style=color:#f92672>!!</span>.isEmpty()) {
		<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
	}
	<span style=color:#66d9ef>return</span> bagDefs.<span style=color:#66d9ef>get</span>(color)<span style=color:#f92672>!!</span>.map { <span style=color:#66d9ef>it</span>.count * (<span style=color:#ae81ff>1</span> + countBags(<span style=color:#66d9ef>it</span>.color)) }.sum()
}
</code></pre></div></div><div class=btn-improve-page><a href=https://github.com/hugo-toha/hugo-toha.github.io/edit/master/content/posts/Advent%20of%20Code%202020/day7.md><i class="fas fa-code-branch"></i>Improve this page</a></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/advent-of-code-2020/day8/ class="btn btn-outline-info"><span><i class="fas fa-chevron-circle-left"></i>Prev</span><br><span>Day 8: Halting</span></a></div><div class="col-md-6 next-article"><a href=/posts/advent-of-code-2020/day6/ class="btn btn-outline-info"><span>Next <i class="fas fa-chevron-circle-right"></i></span><br><span>Day 6: Customs</span></a></div></div><hr></div></div></div></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#solution>Solution</a><ul><li><a href=#part-1>Part 1</a></li><li><a href=#part-2>Part 2</a></li></ul></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=#about>About</a></li><li class=nav-item><a class=smooth-scroll href=#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=#recent-posts>Recent Posts</a></li><li class=nav-item><a class=smooth-scroll href=#achievements>Achievements</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email:</span> <span>kristofachten@gmail.com</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=#><img src=/assets/images/inverted-logo.png>
Toha</a></div><div class="col-md-4 text-center">divyak © 2020 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/>Powered by
<img src=/assets/images/hugo-logo-wide.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/assets/js/jquery-3.4.1.min.js></script><script src=/assets/js/popper.min.js></script><script src=/assets/js/bootstrap.min.js></script><script src=/assets/js/navbar.js></script><script src=/assets/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/assets/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>